name: Build Docker Images

on:
  workflow_dispatch:
    inputs:
      qt_version:
        description: 'Qt version to install'
        required: true
        default: '6.9.3'

permissions:
  contents: read
  packages: write
  
env:
  REGISTRY: ghcr.io
  IMAGE_PREFIX: odizinne

jobs:
  build-linux-noqt:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4
     
      - name: Login to GitHub Container Registry
        run: echo "${{ secrets.GITHUB_TOKEN }}" | docker login ghcr.io -u ${{ github.actor }} --password-stdin
     
      - name: Build and push
        run: |
          cd linux/noqt-ubuntu-22.04
          docker build -t ${{ env.REGISTRY }}/${{ env.IMAGE_PREFIX }}/noqt-ubuntu-22.04:latest .
          docker push ${{ env.REGISTRY }}/${{ env.IMAGE_PREFIX }}/noqt-ubuntu-22.04:latest

  build-linux-latestqt:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4
     
      - name: Login to GitHub Container Registry
        run: echo "${{ secrets.GITHUB_TOKEN }}" | docker login ghcr.io -u ${{ github.actor }} --password-stdin
     
      - name: Build and push
        run: |
          cd linux/latestqt-ubuntu-22.04
          docker build --build-arg QT_VERSION=${{ github.event.inputs.qt_version || '6.9.3' }} -t ${{ env.REGISTRY }}/${{ env.IMAGE_PREFIX }}/latestqt-ubuntu-22.04:latest .
          docker push ${{ env.REGISTRY }}/${{ env.IMAGE_PREFIX }}/latestqt-ubuntu-22.04:latest

  build-wasm-latestqt:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4
     
      - name: Login to GitHub Container Registry
        run: echo "${{ secrets.GITHUB_TOKEN }}" | docker login ghcr.io -u ${{ github.actor }} --password-stdin
     
      - name: Build and push
        run: |
          cd wasm/latestqt-wasm-ubuntu-22.04
          docker build --build-arg QT_VERSION=${{ github.event.inputs.qt_version || '6.9.3' }} -t ${{ env.REGISTRY }}/${{ env.IMAGE_PREFIX }}/wasm-ubuntu-22.04:latest .
          docker push ${{ env.REGISTRY }}/${{ env.IMAGE_PREFIX }}/wasm-ubuntu-22.04:latest